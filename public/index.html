<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .task { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Task Manager</h1>

    <!-- فرم لاگین -->
    <div id="login-section">
        <h2>Login</h2>
        <input type="email" id="email" placeholder="Email" value="sajjad@example.com">
        <input type="password" id="password" placeholder="Password" value="password">
        <button onclick="login()">Login</button>
        <p class="error" id="login-error"></p>
    </div>

    <!-- فرم ایجاد وظیفه -->
    <div id="task-section" style="display: none;">
        <h2>Create Task</h2>
        <input type="text" id="task-title" placeholder="Title">
        <input type="text" id="task-description" placeholder="Description">
        <button onclick="createTask()">Create Task</button>
        <p class="error" id="task-error"></p>

        <h2>Tasks</h2>
        <div id="tasks-list"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        let token = null;

        // لاگین و گرفتن توکن
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('login-error');

            try {
                const response = await axios.post('http://localhost:8000/api/v1/login', {
                    email,
                    password
                });
                token = response.data.token;
                errorElement.textContent = 'Login successful!';
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('task-section').style.display = 'block';
                fetchTasks();
            } catch (error) {
                errorElement.textContent = error.response?.data?.message || 'Login failed';
            }
        }

        // گرفتن لیست وظایف
        async function fetchTasks() {
            const tasksList = document.getElementById('tasks-list');
            try {
                const response = await axios.get('http://localhost:8000/api/v1/tasks');
                tasksList.innerHTML = response.data.map(task => `
                    <div class="task">
                        <strong>${task.title}</strong>: ${task.description || ''} (Completed: ${task.completed})
                        <button onclick="updateTask(${task.id})">Toggle Complete</button>
                        <button onclick="deleteTask(${task.id})">Delete</button>
                    </div>
                `).join('');
            } catch (error) {
                tasksList.innerHTML = '<p class="error">Failed to load tasks</p>';
            }
        }

        // ایجاد وظیفه جدید
        async function createTask() {
            const title = document.getElementById('task-title').value;
            const description = document.getElementById('task-description').value;
            const errorElement = document.getElementById('task-error');

            try {
                const response = await axios.post('http://localhost:8000/api/v1/tasks', {
                    title,
                    description,
                    completed: false
                }, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                errorElement.textContent = 'Task created!';
                fetchTasks();
            } catch (error) {
                errorElement.textContent = error.response?.data?.message || 'Failed to create task';
            }
        }

        // تغییر وضعیت وظیفه
        async function updateTask(id) {
            try {
                const response = await axios.get(`http://localhost:8000/api/v1/tasks/${id}`);
                const task = response.data;
                await axios.put(`http://localhost:8000/api/v1/tasks/${id}`, {
                    completed: !task.completed
                }, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                fetchTasks();
            } catch (error) {
                document.getElementById('task-error').textContent = error.response?.data?.message || 'Failed to update task';
            }
        }

        // حذف وظیفه
        async function deleteTask(id) {
            try {
                await axios.delete(`http://localhost:8000/api/v1/tasks/${id}`, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                fetchTasks();
            } catch (error) {
                document.getElementById('task-error').textContent = error.response?.data?.message || 'Failed to delete task';
            }
        }
    </script>
</body>
</html>